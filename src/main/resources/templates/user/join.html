<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Hugo 0.84.0">
    <title>회원가입</title>

    <link rel="canonical" href="https://getbootstrap.com/docs/5.0/examples/sign-in/">

    <!-- Bootstrap core CSS -->
    <link href="/css/bootstrap.min.css" rel="stylesheet">

    <style>
        .bd-placeholder-img {
            font-size: 1.125rem;
            text-anchor: middle;
            -webkit-user-select: none;
            -moz-user-select: none;
            user-select: none;
        }

        @media (min-width: 768px) {
            .bd-placeholder-img-lg {
                font-size: 3.5rem;
            }
        }
    </style>

    <!-- Custom styles for this template -->
    <link href="/css/login.css" rel="stylesheet">
</head>

<body class="text-center">

<main class="form-signin">
    <form th:action="@{/user/join}" th:object="${user}" method="POST">
        <img class="mb-4" src="/assets/cloud.png" alt="" width="120" height="120">
        <h1 class="h3 mb-3 fw-normal">회원 가입</h1>

        <div class="form-floating">
            <input type="text" class="form-control" id="email" th:field="*{email}" name="email" placeholder="Email" required>
            <label for="email">Email</label>
<!--            <div class="invalid-feedback" th:if="${#fields.hasErrors('email')}" th:errors="*{email}">중복 이메일</div>-->
            <button id="email_check" type="button" onclick="checkEmail()">중복확인</button>
        </div>
        <div class="form-floating">
            <input type="text" class="form-control" id="name" th:field="*{name}" placeholder="Name" required>
            <label for="name">Name</label>
        </div>
        <div class="form-floating">
            <input type="password" class="form-control" id="password" th:classappend="${#fields.hasErrors('password')} ? 'is-invalid'" name="password" placeholder="Password" required>
            <div class="invalid-feedback" th:if="${#fields.hasErrors('password')}" th:errors="*{password}"></div>
            <label for="password">password</label>
        </div>
        <div class="form-floating">
            <input type="password" class="form-control" id="passwordConf" th:field="*{passwordConf}" placeholder="Password" required>
            <label for="passwordConf">password 확인</label>
        </div>
        <div>
            <label><input type="radio" name="role" value="student" checked th:field="*{role}" th:value="${user.role.ROLE_STUDENT}"> 학생</label>
            <label><input type="radio" name="role" value="instructor" th:field="*{role}" th:value="${user.role.ROLE_INSTRUCTOR}"> 교육자</label>
        </div>

        <input type="hidden" id="emailAvailability" name="emailAvailability" th:field="*{emailAvailability}" th:value="false">
        <!--        <p class="mt-5 mb-3 text-muted">&copy; 2017–2021</p>-->
    </form>

</main>

<!--<script src="/js/scripts.js"></script>-->
<div th:replace="/fragments/script.html::fragment-script"></div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    function checkEmail() {
        var email = $("#email").val();

        $.ajax({
            type: "POST",
            url: "/user/check-email/" + email,
            success: function (response) {
                if (response.available) {
                    alert("사용 가능한 이메일입니다.");
                    $("#emailAvailability").val("true");
                } else {
                    alert("중복된 이메일입니다.");
                    $("#emailAvailability").val("false");
                }
            },
            error: function () {
                console.error("이메일 중복 확인 요청 실패");
            }
        });
    }
</script>


</body>
</html>
